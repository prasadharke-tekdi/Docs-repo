"use strict";(self.webpackChunkmy_site=self.webpackChunkmy_site||[]).push([[7617],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>y});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=r.createContext({}),p=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(i.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),g=o,y=c["".concat(i,".").concat(g)]||c[g]||d[g]||a;return n?r.createElement(y,s(s({ref:t},u),{},{components:n})):r.createElement(y,s({ref:t},u))}));function y(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=g;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[c]="string"==typeof e?e:o,s[1]=l;for(var p=2;p<a;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}g.displayName="MDXCreateElement"},6844:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var r=n(7462),o=(n(7294),n(3905));const a={},s="Installing Graylog and Configure Server",l={unversionedId:"Learning/Graylog installation",id:"Learning/Graylog installation",title:"Installing Graylog and Configure Server",description:"Prerequisites",source:"@site/docs/Learning/Graylog installation.md",sourceDirName:"Learning",slug:"/Learning/Graylog installation",permalink:"/docs/Learning/Graylog installation",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Grafana Installation and Dashboard Setup",permalink:"/docs/Learning/Grafana"},next:{title:"Graylog Installation with docker-compose file",permalink:"/docs/Learning/Graylog with Docker compose"}},i={},p=[],u={toc:p},c="wrapper";function d(e){let{components:t,...a}=e;return(0,o.kt)(c,(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"installing-graylog-and-configure-server"},"Installing Graylog and Configure Server"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Prerequisites")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"JDK"),(0,o.kt)("li",{parentName:"ol"},"MongoDB"),(0,o.kt)("li",{parentName:"ol"},"Elasticsearch"),(0,o.kt)("li",{parentName:"ol"},"Graylog")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Installing JDK")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo apt-get update && sudo apt-get upgrade\nsudo apt-get install apt-transport-https openjdk-11-jre-headless uuid-runtime pwgen\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Installing MongoDB")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4\n\necho "deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list\n\nsudo apt-get update\nsudo apt-get install -y mongodb-org\n')),(0,o.kt)("p",null,"The last step is to enable MongoDB during the operating system\u2019s startup and verify it is running."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl daemon-reload\nsudo systemctl enable mongod.service\nsudo systemctl restart mongod.service\nsudo systemctl --type=service --state=active | grep mongod\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Installing ElasticSearch")),(0,o.kt)("p",null,"Graylog can be used with Elasticsearch 7.x; follow the below instructions to install the open-source version of Elasticsearch."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'wget -q https://artifacts.elastic.co/GPG-KEY-elasticsearch -O myKey\nsudo apt-key add myKey\necho "deb https://artifacts.elastic.co/packages/oss-7.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list\nsudo apt-get update && sudo apt-get install elasticsearch-oss\n')),(0,o.kt)("p",null,"Modify the Elasticsearch configuration file ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/elasticsearch/elasticsearch.yml"),", set the cluster name to Graylog, and uncomment action.auto_create_index: false to enable the action:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo tee -a /etc/elasticsearch/elasticsearch.yml > /dev/null <<EOT\ncluster.name: graylog\naction.auto_create_index: false\nEOT\n")),(0,o.kt)("p",null,"After you have modified the configuration, you can start Elasticsearch and verify it is running."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl daemon-reload\nsudo systemctl enable elasticsearch.service\nsudo systemctl restart elasticsearch.service\nsudo systemctl --type=service --state=active | grep elasticsearch\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Installing Graylog")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wget https://packages.graylog2.org/repo/packages/graylog-4.3-repository_latest.deb\nsudo dpkg -i graylog-4.3-repository_latest.deb\nsudo apt-get update && sudo apt-get install graylog-server graylog-enterprise-plugins graylog-integrations-plugins graylog-enterprise-integrations-plugins\n")),(0,o.kt)("p",null,"If you do not want the Integrations Plugins or the Operations Plugins installed, then simply run sudo apt-get install graylog-server."),(0,o.kt)("p",null,"Edit the Configuration File:\nRead the instructions within the configurations file and edit as needed, located at ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/graylog/server/server.conf"),". Additionally, add ",(0,o.kt)("inlineCode",{parentName:"p"},"password_secret")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"root_password_sha2")," as these are mandatory and Graylog will not start without them."),(0,o.kt)("p",null,"To create your ",(0,o.kt)("inlineCode",{parentName:"p"},"root_password_sha2")," run the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'echo -n "Enter Password: " && head -1 </dev/stdin | tr -d \'\\n\' | sha256sum | cut -d" " -f1\n')),(0,o.kt)("p",null,"To be able to connect to Graylog, you should set http_bind_address to the public hostname or a public IP address of the machine to which you can connect. More information about these settings can be found in Configuring the web interface."),(0,o.kt)("p",null,"The last step is to enable Graylog during the operating system\u2019s startup and verify it is running."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl daemon-reload\nsudo systemctl enable graylog-server.service\nsudo systemctl start graylog-server.service\nsudo systemctl --type=service --state=active | grep graylog\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Creating an Input In Graylog Dashboard")),(0,o.kt)("p",null,"Let\u2019s add a new input to Graylog to receive logs. Inputs tell Graylog which port to listen on and which protocol to use when receiving logs. We 'll add a Syslog UDP input, which is a commonly used logging protocol."),(0,o.kt)("p",null,"When you visit ",(0,o.kt)("strong",{parentName:"p"},"http://your_server_ip:9000")," in your browser, you\u2019ll see a login page."),(0,o.kt)("p",null,"To view the inputs page, click the System dropdown in the navigation bar and select Inputs."),(0,o.kt)("p",null,"You\u2019ll then see a dropdown box that contains the text Select Input. Select Syslog UDP from this dropdown, and then click on the Launch new input button."),(0,o.kt)("p",null,"A modal with a form should appear. Fill in the following details to create your input:"),(0,o.kt)("p",null,"For Node, select your server. It should be the only item in the list."),(0,o.kt)("p",null,"For Title, enter a suitable title, such as Linux Server Logs."),(0,o.kt)("p",null,"For Bind address, use your server\u2019s private IP. If you also want to be able to collect logs from external servers (not recommended, as Syslog does not support authentication), you can set it to ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"0.0.0.0"))," (all interfaces)."),(0,o.kt)("p",null,"For Port, enter ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"8514")),". Note that we are using port ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"8514"))," for this because ports ",(0,o.kt)("inlineCode",{parentName:"p"},"0")," through ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"1024"))," can be only used by the root user. You can use any port number above ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"1024"))," should be fine as long as it doesn\u2019t conflict with any other services."),(0,o.kt)("p",null,"Click Save. The local input listing will update and show your new input, as shown in the following figure"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"graylog",src:n(1153).Z,width:"1239",height:"413"})),(0,o.kt)("p",null,"Now that an input has been created, we can send some logs to Graylog.\nConfigure Server to send Logs to Graylog"),(0,o.kt)("p",null,"We have an input configured and listening on port ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"1514")),", but we are not sending any data to the input yet, so we won\u2019t see any results. rsyslog is a software utility used to forward logs and is pre-installed on Ubuntu, so we\u2019ll configure that to send logs to Graylog.\nWe'll configure the Ubuntu server running Graylog to send its system logs to the input we just created, but you can follow these steps on any other servers you may have."),(0,o.kt)("p",null,"If you want to send data to Graylog from other servers, you need to add a firewall exception for UDP port ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"8514")),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo ufw allow 8514/udp\n")),(0,o.kt)("p",null,"Create and open a new rsyslog configuration file in your editor."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo nano /etc/rsyslog.d/60-graylog.conf\n")),(0,o.kt)("p",null,"Add the following line to the file, replacing your_server_private_ip with your Graylog server\u2019s private IP."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"*.* @your_server_private_ip:8514;RSYSLOG_SyslogProtocol23Format")),(0,o.kt)("p",null,"Save and exit your editor."),(0,o.kt)("p",null,"Restart the rsyslog service so the changes take effect."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl restart rsyslog\n")),(0,o.kt)("p",null,"Repeat these steps for each server you want to send logs from.\nYou should now be able to view your logs in the web interface. Click the Sources tab in the navigation bar to view a graph of the sources. It should look something like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"graylog",src:n(8e3).Z,width:"1261",height:"933"})))}d.isMDXComponent=!0},1153:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/img1-f2c9b133f2212f00561913340e90586f.png"},8e3:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/img2-c72c1600be098bab3d1ea5882b5f475e.png"}}]);